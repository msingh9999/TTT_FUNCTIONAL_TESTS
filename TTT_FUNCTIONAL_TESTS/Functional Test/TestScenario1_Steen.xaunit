<?xml version="1.0" encoding="UTF-8"?>
<XaUnit xmlns="http://www.xact.dk/xatester/v/1" xmlns:data="http://www.xact.dk/xatester/data/v/1">
  <Test>
    <Scope name="File-AID Compare - failure" disabled="false">
      <Job name="File-AID job with differences">
        <Content><![CDATA[/*JOBPARM SYSAFF=CW01                                                    
//*  YOU ARE VIEWING JCL THAT FILE-AID/MVS HAS GENERATED TO             
//*  COMPARE DATASETS.                                                  
//*                                                                      
//*  YOU CAN CHANGE THIS JCL IF DESIRED AND USE THE SUBMIT PRIMARY      
//*  COMMAND TO SUBMIT THE JOB. THE CREATE OR REPLACE PRIMARY COMMAND   
//*  CAN BE USED TO KEEP THIS JOBSTREAM FOR FUTURE USE.                 
//*                                                                     
//*  USE THE END COMMAND TO EXIT WITHOUT SUBMITTING THE JOB.            
//*                                                                     
//*  COPYRIGHT (C) 2012 BY COMPUWARE CORPORATION, ALL RIGHTS RESERVED.  
//*                                                                     
//FASTEP   EXEC PGM=FILEAID,REGION=08M                                  
//STEPLIB  DD DISP=SHR,DSN=FK.R170000.SMPE.CXVJLOAD                      
//         DD DISP=SHR,DSN=FK.R170000.SMPE.SXVJLOAD                     
//SYSPRINT DD  SYSOUT=*                                                 
//SYSLIST  DD  SYSOUT=*,DCB=(LRECL=183,BLKSIZE=1830)                    
//DD01     DD  DSN=PFHKXC0.FASAMP.EMPLOYEE,                             
//             DISP=SHR                                                 
//DD01C    DD  DSN=PFHKXC0.FASAMP.EMPLOYEE.TWO,                         
//             DISP=SHR                                                  
//DD01CP   DD  DSN=PFHKXC0.FILEAID.CC.D19239.T145602,                   
//             DISP=SHR                                                 
//DD01RL   DD  DSN=PFHKXC0.FASAMP.LAYOUTS,                              
//             DISP=SHR                                                 
//SYSIN    DD  *                                                        
$$DD01 COMPARE                                                          
/*]]></Content>
      </Job>
      <SpoolFile ddname="SYSLIST" stepname="FASTEP" ashex="false" id="spoolId" />
      <Verify name="Verify file-AID compare spool file" haltExecution="false">
        <Statement><![CDATA[println('Finding number of changed records')
var lines = spoolId.split("\n");
println('lines:')+lines.length;
var result = true;
lines.forEach(function(line){
  if(line.indexOf('NUMBER OF RECORDS CHANGED:')!=-1){
    println('Line found:'+line);
    var start = line.indexOf('NUMBER OF RECORDS CHANGED:') + 26;
    var changed = parseInt(line.substring(start).trim());
    println('Number of changed records:'+changed);
    if(changed>0){
      println('Number of changed records are larger than 0. Therefore we fail the test case');
      result=false;
    }else{
      println('No records were changed - success')
    }   
  }
})
result;]]></Statement>
      </Verify>
    </Scope>
  </Test>
</XaUnit>
